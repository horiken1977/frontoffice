<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²æ—ç®¡ç† - ãƒ•ãƒ­ãƒ³ãƒˆã‚ªãƒ•ã‚£ã‚¹ç”Ÿç”£æ€§å‘ä¸Šã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="progress-sync.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-bold text-gray-800">ãƒ•ãƒ­ãƒ³ãƒˆã‚ªãƒ•ã‚£ã‚¹ç”Ÿç”£æ€§å‘ä¸Šã‚¢ãƒ—ãƒª</h1>
                <div class="space-x-4">
                    <a href="index.html" class="text-blue-600 hover:text-blue-800 font-medium">é€²æ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                    <a href="plan.html" class="text-blue-600 hover:text-blue-800 font-medium">é–‹ç™ºè¨ˆç”»æ›¸</a>
                    <a href="test-specification.html" class="text-blue-600 hover:text-blue-800 font-medium">ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸</a>
                    <a href="progress-admin.html" class="text-gray-800 font-medium border-b-2 border-blue-600">é€²æ—ç®¡ç†</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">é€²æ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="text-xl text-gray-600 mb-4">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ãƒ‡ãƒ¼ã‚¿ã®ä¸€å…ƒç®¡ç†</p>
        </header>

        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div class="grid md:grid-cols-4 gap-4">
                <button onclick="markFeatureComplete()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    âœ… æ©Ÿèƒ½å®Œäº†ãƒãƒ¼ã‚¯
                </button>
                <button onclick="updatePhaseProgress()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    ğŸ“Š ãƒ•ã‚§ãƒ¼ã‚ºé€²æ—æ›´æ–°
                </button>
                <button onclick="syncAllPages()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    ğŸ”„ å…¨ãƒšãƒ¼ã‚¸åŒæœŸ
                </button>
                <button onclick="exportProgressData()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
            </div>
        </div>

        <!-- æ©Ÿèƒ½é€²æ—ç·¨é›† -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">æ©Ÿèƒ½é€²æ—ç·¨é›†</h2>
            <div id="feature-list" class="space-y-4">
                <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç† -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç†</h2>
            <div id="phase-list" class="space-y-4">
                <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- åŒæœŸçŠ¶æ³ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">åŒæœŸçŠ¶æ³</h2>
            <div id="sync-status" class="space-y-2">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (index.html)</span>
                    <span class="text-green-600">âœ… åŒæœŸæ¸ˆã¿</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span>é–‹ç™ºè¨ˆç”»æ›¸ (plan.html)</span>
                    <span class="text-green-600">âœ… åŒæœŸæ¸ˆã¿</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span>ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ (test-specification.html)</span>
                    <span class="text-green-600">âœ… åŒæœŸæ¸ˆã¿</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ProgressAdmin {
            constructor() {
                this.progressData = null;
                this.init();
            }

            async init() {
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                if (window.progressSync) {
                    await window.progressSync.loadProgressData();
                    this.progressData = window.progressSync.progressData;
                    this.renderFeatureList();
                    this.renderPhaseList();
                }
            }

            renderFeatureList() {
                const container = document.getElementById('feature-list');
                if (!this.progressData) return;

                container.innerHTML = this.progressData.features.map(feature => `
                    <div class="p-4 border rounded-lg ${feature.status === 'completed' ? 'bg-green-50' : feature.status === 'in_progress' ? 'bg-blue-50' : 'bg-gray-50'}">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold">${feature.name}</h3>
                                <p class="text-sm text-gray-600">${feature.description}</p>
                                <span class="text-xs text-gray-500">${feature.phase} | ${feature.category}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <select onchange="updateFeatureStatus('${feature.id}', this.value)" class="px-2 py-1 border rounded text-sm">
                                    <option value="pending" ${feature.status === 'pending' ? 'selected' : ''}>æœªå®Ÿè£…</option>
                                    <option value="in_progress" ${feature.status === 'in_progress' ? 'selected' : ''}>é€²è¡Œä¸­</option>
                                    <option value="completed" ${feature.status === 'completed' ? 'selected' : ''}>å®Œäº†</option>
                                </select>
                                <input type="range" min="0" max="100" value="${feature.progress}" 
                                       onchange="updateFeatureProgress('${feature.id}', this.value)"
                                       class="w-20">
                                <span class="text-sm font-medium w-12">${feature.progress}%</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            renderPhaseList() {
                const container = document.getElementById('phase-list');
                if (!this.progressData) return;

                container.innerHTML = this.progressData.phases.map(phase => `
                    <div class="p-4 border rounded-lg ${phase.status === 'completed' ? 'bg-green-50' : phase.status === 'in_progress' ? 'bg-blue-50' : 'bg-gray-50'}">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold">${phase.name}</h3>
                                <p class="text-sm text-gray-600">${phase.description}</p>
                                <span class="text-xs text-gray-500">äºˆç®—: ${phase.budget}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <select onchange="updatePhaseStatus('${phase.id}', this.value)" class="px-2 py-1 border rounded text-sm">
                                    <option value="pending" ${phase.status === 'pending' ? 'selected' : ''}>äºˆå®š</option>
                                    <option value="in_progress" ${phase.status === 'in_progress' ? 'selected' : ''}>é€²è¡Œä¸­</option>
                                    <option value="completed" ${phase.status === 'completed' ? 'selected' : ''}>å®Œäº†</option>
                                </select>
                                <span class="text-sm font-medium">${window.progressSync?.calculatePhaseProgress(phase.id) || phase.progress}%</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        function updateFeatureStatus(featureId, status) {
            if (!window.progressSync?.progressData) return;
            
            const feature = window.progressSync.progressData.features.find(f => f.id === featureId);
            if (feature) {
                feature.status = status;
                if (status === 'completed') feature.progress = 100;
                if (status === 'pending') feature.progress = 0;
                
                console.log(`æ©Ÿèƒ½ ${feature.name} ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ ${status} ã«æ›´æ–°`);
                autoSyncPages();
            }
        }

        function updateFeatureProgress(featureId, progress) {
            if (!window.progressSync?.progressData) return;
            
            const feature = window.progressSync.progressData.features.find(f => f.id === featureId);
            if (feature) {
                feature.progress = parseInt(progress);
                if (progress == 100) feature.status = 'completed';
                else if (progress > 0) feature.status = 'in_progress';
                else feature.status = 'pending';
                
                console.log(`æ©Ÿèƒ½ ${feature.name} ã®é€²æ—ã‚’ ${progress}% ã«æ›´æ–°`);
                autoSyncPages();
            }
        }

        function updatePhaseStatus(phaseId, status) {
            if (!window.progressSync?.progressData) return;
            
            const phase = window.progressSync.progressData.phases.find(p => p.id === phaseId);
            if (phase) {
                phase.status = status;
                if (status === 'completed' && !phase.completedDate) {
                    phase.completedDate = new Date().toISOString().split('T')[0];
                }
                
                console.log(`ãƒ•ã‚§ãƒ¼ã‚º ${phase.name} ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ ${status} ã«æ›´æ–°`);
                autoSyncPages();
            }
        }

        function markFeatureComplete() {
            const featureId = prompt('å®Œäº†ãƒãƒ¼ã‚¯ã™ã‚‹æ©Ÿèƒ½IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (featureId) {
                updateFeatureStatus(featureId, 'completed');
                window.progressAdmin.renderFeatureList();
            }
        }

        function updatePhaseProgress() {
            if (window.progressSync) {
                window.progressSync.progressData.project.lastUpdated = new Date().toISOString().split('T')[0];
                autoSyncPages();
                alert('ãƒ•ã‚§ãƒ¼ã‚ºé€²æ—ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
            }
        }

        function syncAllPages() {
            if (window.progressSync) {
                window.progressSync.syncAllPages();
                alert('å…¨ãƒšãƒ¼ã‚¸ã®åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸ');
            }
        }

        function exportProgressData() {
            if (window.progressSync?.progressData) {
                const dataStr = JSON.stringify(window.progressSync.progressData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `project-progress-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
            }
        }

        function autoSyncPages() {
            // è‡ªå‹•åŒæœŸï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã“ã“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãæˆ»ã—ã‚’è¡Œã†ï¼‰
            setTimeout(() => {
                if (window.progressSync) {
                    window.progressSync.syncAllPages();
                }
            }, 100);
        }

        // åˆæœŸåŒ–
        let progressAdmin;
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                progressAdmin = new ProgressAdmin();
                window.progressAdmin = progressAdmin;
            }, 200);
        });
    </script>
</body>
</html>